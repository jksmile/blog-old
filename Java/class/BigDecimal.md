

## BigDecimal类分析

*   [1.前言](#preface)

*   [2.精度](#precision)

*   [2.舍入模式分析](#roundMode)

*   [3.总结](#summary)


***


<h3 id="preface" class="blueJK">1.前言</h3>


最近在一个有关金融项目中接触并使用BigDecimal类，显然使用BigDecimal类是为了防止计算中精度丢失。


我们都知道JAVA为浮点数的计算提供了单精度的float,双精度的double这个基本类型：

float类型，占4字节，共32位，从高位到低位【左->右】分别划分 1符号位【0正1负】、8指数位、23尾数位；

double类型，占8字节，共64位，从高位到低位【左->右】分别划分 1符号位【0正1负】、11指数位、52尾数位；


***


<h3 id="precision" class="blueJK">2.精度</h3>

**为什么float,double会有精度丢失？**

提这个问题先要联想到另一个问题：在十进制中 1/3 能用小数表示么？0.33333...  能精确表示1/3么？有限位精度丢失！



**举个粟子：**

    ■ float x = 0.5f;

    ■ float y = 0.4f;

    ---------------------------------------------------------------------------

    ■变量x是float类型，值是0.5 用32位可以精确表示0.5吗？我们算一下：

     将0.5表示成二进制科学计算形式: 0.5 = 0.5*2 * 2^(-1) = 1.0 * 2^(-1)

     指数为-1，在指数位上怎么表示？指数位是没有单独的符号位来区别正负的！

     但是通过 127 这个偏移量 (移码)，可以区分出指数的正负，大于127表示正，小于127表示负，等于127表示0；

     所以在指数位表示数时要加一个偏移量127。

     回归正题，0.5 = 1.0 * 2^(-1)

     指数位表示：127+(-1) = 126 = b01111110；


      符号位  指数位      尾数位
      0      00000000   00000000000000000000000

      0      01111110   00000000000000000000000

     所以0.5可以用float类型精确表示，不失去精度！
    ---------------------------------------------------------------------------

    ■变量y是float类型，表面上看值是0.4，但在计算机存储中是0.4吗？ Go on...

     0.4*2  = 0.8   0   0 * 2^(-1)

     0.8*2  = 1.6   1   1 * 2^(-2)

     0.6*2  = 1.2   1   1 * 2^(-3)

     0.2*2  = 0.4   0   0 * 2^(-4)

     0.4*2  = 0.8   0   0 * 2^(-5)

     0.8*2  = 1.6   1   1 * 2^(-6)

     0.6*2  = 1.2   1   1 * 2^(-7)

     0.2*2  = 0.4   0   0 * 2^(-8)

     ...

     符号位  指数位      尾数位
     0      00000000   00000000000000000000000

     0      00000000   01100110011001100110011

     float y=0.4f;  实际在存储的值是接受于0.4的，这就是精度丢失！有限位没法精确表示出0.4的值。


***


<h3 id="roundMode" class="blueJK">2.舍入模式分析</h3>

我们回归到BigDecimal类，接下来我们要讨论的是BigDecimal类提供的几种舍入模式。

**在BigDecimal类对8种舍入模式中定义了静态常量：**

        //正数向上取整值，负数向下取整值
        public final static int ROUND_UP =           0;

        //正数向下取整值，负数向上取整值
        public final static int ROUND_DOWN =         1;

        //向上取整值
        public final static int ROUND_CEILING =      2;

        //向下取整值
        public final static int ROUND_FLOOR =        3;

        //正数逢5向上取整，负数逢5向下取整
        public final static int ROUND_HALF_UP =      4;

        //正数逢5向下取整，负数逢5向上取整
        public final static int ROUND_HALF_DOWN =    5;

        //逢5  奇进偶退
        public final static int ROUND_HALF_EVEN =    6;

        //精确结果不需要取舍
        public final static int ROUND_UNNECESSARY =  7;


    【Phone View】
    +--------------------------------------------------+
    | InputNum | UP | DOWN | CEILING | FLOOR | HALF_UP |
    |----------|----|------|---------|-------|---------|
    |   5.5    |  6 |   5  |    6    |   5   |    6    |
    |----------|----|------|---------|-------|---------|
    |   2.5    |  3 |   2  |    3    |   2   |    3    |
    |----------|----|------|---------|-------|---------|
    |   1.8    |  2 |   1  |    2    |   1   |    2    |
    |----------|----|------|---------|-------|---------|
    |   1.4    |  2 |   1  |    2    |   1   |    1    |
    |----------|----|------|---------|-------|---------|
    |   1.0    |  1 |   1  |    1    |   1   |    1    |
    |----------|----|------|---------|-------|---------|
    |  -1.4    | -2 |  -1  |   -1    |   -2  |   -1    |
    |----------|----|------|---------|-------|---------|
    |  -1.8    | -2 |  -1  |   -1    |   -2  |   -2    |
    |----------|----|------|---------|-------|---------|
    |  -2.5    | -3 |  -2  |   -2    |   -3  |   -3    |
    |----------|----|------|---------|-------|---------|
    |  -5.5    | -6 |  -5  |   -5    |   -6  |   -6    |
    +----------|----|------|---------|-------|---------+

    +------------------------------------------------+
    | InputNum | HALF_DOWN | HALF_EVEN | UNNECESSARY |
    |----------|-----------|-----------|-------------|
    |   5.5    |     5     |     6     |  Exception  |
    |----------|-----------|-----------|-------------|
    |   2.5    |     2     |     2     |  Exception  |
    |----------|-----------|-----------|-------------|
    |   1.8    |     2     |     2     |  Exception  |
    |----------|-----------|-----------|-------------|
    |   1.4    |     1     |     1     |  Exception  |
    |----------|-----------|-----------|-------------|
    |   1.0    |     1     |     1     |      1      |
    |----------|-----------|-----------|-------------|
    |  -1.4    |    -1     |     -1    |  Exception  |
    |----------|-----------|-----------|-------------|
    |  -1.8    |    -2     |     -2    |  Exception  |
    |----------|-----------|-----------|-------------|
    |  -2.5    |    -2     |     -2    |  Exception  |
    |----------|-----------|-----------|-------------|
    |  -5.5    |    -5     |     -6    |  Exception  |
    +----------|-----------|-----------|-------------+



    【PC View】
    +----------------------------------------------------------------------------------------+
    | InputNum | UP | DOWN | CEILING | FLOOR | HALF_UP | HALF_DOWN | HALF_EVEN | UNNECESSARY |
    |----------|----|------|---------|-------|---------|-----------|-----------|-------------|
    |   5.5    |  6 |   5  |    6    |   5   |    6    |     5     |     6     |  Exception  |
    |----------|----|------|---------|-------|---------|-----------|-----------|-------------|
    |   2.5    |  3 |   2  |    3    |   2   |    3    |     2     |     2     |  Exception  |
    |----------|----|------|---------|-------|---------|-----------|-----------|-------------|
    |   1.8    |  2 |   1  |    2    |   1   |    2    |     2     |     2     |  Exception  |
    |----------|----|------|---------|-------|---------|-----------|-----------|-------------|
    |   1.4    |  2 |   1  |    2    |   1   |    1    |     1     |     1     |  Exception  |
    |----------|----|------|---------|-------|---------|-----------|-----------|-------------|
    |   1.0    |  1 |   1  |    1    |   1   |    1    |     1     |     1     |      1      |
    |----------|----|------|---------|-------|---------|-----------|-----------|-------------|
    |  -1.4    | -2 |  -1  |   -1    |   -2  |    -1   |    -1     |     -1    |  Exception  |
    |----------|----|------|---------|-------|---------|-----------|-----------|-------------|
    |  -1.8    | -2 |  -1  |   -1    |   -2  |    -2   |    -2     |     -2    |  Exception  |
    |----------|----|------|---------|-------|---------|-----------|-----------|-------------|
    |  -2.5    | -3 |  -2  |   -2    |   -3  |    -3   |    -2     |     -2    |  Exception  |
    |----------|----|------|---------|-------|---------|-----------|-----------|-------------|
    |  -5.5    | -6 |  -5  |   -5    |   -6  |    -6   |    -5     |     -6    |  Exception  |
    +----------|----|------|---------|-------|---------|-----------|-----------|-------------+


***


<h3 id="summary" class="blueJK">3.总结</h3>



Waiting for update.
